require 'open3'
require 'json'
require 'httparty'


coordString = "-86.9116559,40.461655;-86.921173,40.46331199999999;-86.92182,40.46331;-86.90959199999999,40.4673048;-86.9364658,40.4795477;-86.97491,40.475311;-86.90780629999999,40.4946867;-86.90099339999999,40.47090149999999;-86.92161779999999,40.45996969999999;-86.92226699999999,40.450081;-86.9229952,40.4576658;-86.92029099999999,40.463401;-86.921531,40.463736;-86.9042097,40.4640966;-86.9121128,40.5065488;-86.922682,40.46330700000001;-86.91655659999999,40.448682;-86.9032374,40.4725059;-86.9030104,40.47211;-86.98910599999999,40.435795;-86.9470585,40.46160639999999;-86.90726099999999,40.457912;-86.90367379999999,40.4702912;-86.9206475,40.4563979;-86.92214899999999,40.464022;-86.900339,40.459672;-86.97382999999999,40.449302;-86.92192299999999,40.46402299999999;-86.92192299999999,40.46402299999999;-86.9209882,40.4558656;-86.922392,40.464772;-86.92238429999999,40.4561841;-86.90319699999999,40.470201;-86.91618199999999,40.44306400000001;-86.9213879,40.463311;-86.902287,40.4597399;-86.92333699999999,40.46582300000001;-86.92049399999999,40.464429;-86.92251870000001,40.4570323;-86.92251870000001,40.4570323;-86.91167399999999,40.45708200000001;-86.92422619999999,40.4599124;-86.899991,40.46002;-86.9215006,40.4560527;-86.92170999999999,40.4558068;-86.907268,40.458125;-86.92175399999999,40.466011;-86.92249489999999,40.45743569999999;-86.902929,40.436438;-86.9230437,40.457017;-86.9235267,40.45966790000001;-86.91345799999999,40.462501;-86.9037401,40.4616814;-86.97474749999999,40.4698318;-86.90358599999999,40.43591300000001;-86.93565989999999,40.4809583;-86.90704099999999,40.450664;-86.904212,40.468008;-86.912605,40.459863;-86.9204049,40.4594798;-86.9210629,40.45562419999999;-86.90159770000001,40.4464379;-86.9151212,40.4672016;-86.94708179999999,40.4622685;-86.90441299999999,40.4733185;-86.91595099999999,40.4428539;-86.913641,40.464265;-86.91268819999999,40.46016090000001;-86.9229896,40.45885539999999;-86.9214539,40.4588589;-86.95818,40.44019299999999;-86.9229841,40.4598956;-86.90440710000001,40.4634556;-86.90970899999999,40.44376;-86.9223178,40.45677069999999;-86.9140998,40.45069039999999;-86.92173199999999,40.463736;-86.92152949999999,40.45702369999999;-86.9219194,40.4594617;-86.9047627,40.4275769;-86.9216579,40.45682800000001;-86.94530549999999,40.46210009999999;-86.90733089999999,40.4669352;-86.92151559999999,40.456582;-86.9106985,40.468021;-86.9134108,40.4344113;-86.96760739999999,40.44236379999999;-86.90859280000001,40.4957151;-86.93700899999999,40.47727099999999;-86.9048794,40.46432650000001;-86.9149776,40.43535629999999;-87.006254,40.446193;-86.9225359,40.464021;-86.912182,40.4684928;-86.901938,40.459563;-86.91795189999999,40.4486959;-86.96258139999999,40.4735939;-86.9099207,40.4539725;-86.92136599999999,40.466677;-86.9139403,40.4570951"

# 100 coordinate max limit from OSRM
url = "http://router.project-osrm.org/table/v1/driving/#{coordString}"
response = HTTParty.get(url)
puts response["durations"]
# response.parsed_response

location_ids = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32]

locations = [[82, 76], [96, 44], [50, 5], [49, 8], [13, 7], [29, 89], [58, 30], [84, 39], [14, 24], [12, 39], [3, 82], [5, 10], [98, 52], [84, 25], [61, 59], [1, 65], [88, 51], [91, 2], [19, 32], [93, 3], [50, 93], [98, 14], [5, 42], [42, 9], [61, 62], [9, 97], [80, 55], [57, 69], [23, 15], [20, 70], [85, 60], [98, 5]]

duration_per_location = [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]
data = {location_ids: location_ids, locations: locations, duration_per_location: duration_per_location}
json = JSON.dump(data)

# # block form
# Open3.popen3("python ./ortools_d/examples/python/cvrptw_mowflow_wip.py"){|stdin, stdout, stderr, wait_thr|
#   pid = wait_thr[:pid]
#   stdin.write(json)
#   stdin.close()
#   stderr.close()
#   exit_status = wait_thr.value
#   pythondata = stdout.read()
#   json = JSON.parse(pythondata)
#   puts json
# }